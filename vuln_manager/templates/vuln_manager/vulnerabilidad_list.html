{% extends 'base.html' %}
{% load static %}
{% load vuln_manager_filters %}

<!-- DEBUG: Inicio de la plantilla -->
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/severity.css' %}">
{% endblock %}

{% block content %}
<!-- DEBUG: Inicio del contenido -->
<div class="container mt-4">
    <h2>Vulnerabilidades</h2>
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>CVE ID</th>
                    <th>Descripción</th>
                    <th>Severidad</th>
                    <th>Score CVSS</th>
                    <th>Estado</th>
                    <th>Última Modificación</th>
                </tr>
            </thead>
            <tbody>
                {% for vuln in vulnerabilidades %}
                <tr class="clickable-row severity-{{ vuln.cvss3_severidad|severity_to_css_class }}" data-href="{% url 'vuln_manager:vulnerabilidad_detail' vuln.pk %}">
                    <td>{{ vuln.cve_id }}</td>
                    <td>{{ vuln.descripcion_es }}</td>
                    <td>
                        <span class="badge badge-severity-{{ vuln.cvss3_severidad|severity_to_css_class }}">
                            {{ vuln.get_severidad_display }}
                        </span>
                    </td>
                    <td>
                        <span class="{{ vuln.cvss3_severidad|severity_to_css_class }}">
                            {{ vuln.cvss3_score|default:"N/A" }}
                        </span>
                    </td>
                    <td>{{ vuln.get_status_display }}</td>
                    <td>{{ vuln.fecha_modificacion|date:"d/m/Y" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center">No hay vulnerabilidades registradas</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<!-- DEBUG: Fin del contenido -->
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const rows = document.querySelectorAll('.clickable-row');
        rows.forEach(row => {
            row.addEventListener('click', function() {
                window.location.href = this.dataset.href;
            });
        });
    });
</script>
{% endblock %} 