{% extends 'base.html' %}
{% load static %}
{% load vuln_manager_filters %}

{% block title %}Detalle de Activo - Vuln-Asset-Manager{% endblock %}

{% block extra_css %}
{% comment %}
No se necesita CSS adicional específico para esta vista. 
El base.html ya carga severity.css.
{% endcomment %}
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Detalle del Activo: {{ object.nombre }}</h1>
</div>

<div class="card mb-4">
    <div class="card-body">
        <h5 class="card-title">Información General</h5>
        <p class="card-text"><strong>Nombre:</strong> {{ object.nombre }}</p>
        <p class="card-text"><strong>Cliente:</strong> <a href="{% url 'vuln_manager:cliente_detail' object.cliente.pk %}">{{ object.cliente.nombre }}</a></p>
        <p class="card-text"><strong>Tipo:</strong> {{ object.get_tipo_display }}</p>
        <p class="card-text"><strong>Descripción:</strong> {{ object.descripcion|default:"N/A" }}</p>
        <p class="card-text"><strong>Palabras Clave:</strong> {{ object.palabras_clave|default:"N/A" }}</p>
        <p class="card-text"><strong>IP:</strong> {{ object.ip|default:"N/A" }}</p>
        <p class="card-text"><strong>Puerto:</strong> {{ object.puerto|default:"N/A" }}</p>
        <p class="card-text"><strong>Versión:</strong> {{ object.version|default:"N/A" }}</p>
        <p class="card-text"><strong>Fecha de Creación:</strong> {{ object.created_at|date:"d/m/Y H:i" }}</p>
        <p class="card-text"><strong>Última Actualización:</strong> {{ object.updated_at|date:"d/m/Y H:i" }}</p>
    </div>
</div>

<h3>Vulnerabilidades Asociadas</h3>
{% if object.vulnerabilidades.all %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>CVE ID</th>
                <th>Descripción</th>
                <th>Severidad</th>
                <th>CVSS Score</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for vulnerabilidad in object.vulnerabilidades.all %}
            <tr>
                <td>{{ vulnerabilidad.cve_id }}</td>
                <td>{{ vulnerabilidad.descripcion|truncatechars:100 }}</td>
                <td><span class="badge {{ vulnerabilidad.cvss3_severidad|severity_to_css_class }}">{{ vulnerabilidad.cvss3_severidad }}</span></td>
                <td>{{ vulnerabilidad.cvss3_score|default:"N/A" }}</td>
                <td>
                    <a href="{% url 'vuln_manager:vulnerabilidad_detail' vulnerabilidad.pk %}" class="btn btn-info btn-sm">Ver Detalles</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<p>Este activo no tiene vulnerabilidades asociadas.</p>
{% endif %}

<a href="{% url 'vuln_manager:activo_list' %}" class="btn btn-secondary mt-3">Volver a la lista de Activos</a>
{% endblock %} 